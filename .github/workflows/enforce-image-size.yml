      - name: Detect oversized images (>1280px)
        id: scan
        shell: bash
        run: |
          set -euo pipefail
          MAX=1280

          git fetch --no-tags --prune origin "${GITHUB_BASE_REF}:${GITHUB_BASE_REF}" || true

          mapfile -d '' files < <(
            git diff --name-only --diff-filter=AM -z "origin/${GITHUB_BASE_REF}...HEAD" -- \
              '*.png' '*.jpg' '*.jpeg' '*.PNG' '*.JPG' '*.JPEG' || true
          )

          oversized=""
          for f in "${files[@]}"; do
            [[ -f "$f" ]] || continue

            dims="$(ffprobe -v error -select_streams v:0 -show_entries stream=width,height \
              -of csv=p=0:s=x "$f" || true)"

            if [[ -z "$dims" ]]; then
              echo "Skipping (ffprobe couldn't read): $f"
              continue
            fi

            w="${dims%x*}"
            h="${dims#*x}"

            if [[ "${w:-0}" -gt "${MAX}" || "${h:-0}" -gt "${MAX}" ]]; then
              oversized+="${f} (${w}x${h})\n"
            fi
          done

          if [[ -n "$oversized" ]]; then
            {
              echo "oversized<<EOF"
              echo -e "$oversized"
              echo "EOF"
            } >> "$GITHUB_OUTPUT"
            echo "has_oversized=true" >> "$GITHUB_OUTPUT"
          else
            echo "has_oversized=false" >> "$GITHUB_OUTPUT"
          fi
